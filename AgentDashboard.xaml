<!-- AgentDashboard.xaml -->
<Window x:Class="BWP.Enterprise.Agent.UI.AgentDashboard"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:BWP.Enterprise.Agent.UI"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        mc:Ignorable="d"
        Title="BWP Enterprise Agent Dashboard" 
        Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Icon="/Assets/bwp-logo.ico">
    
    <Window.Resources>
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#404040"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect ShadowDepth="2" Opacity="0.3"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#E1E1E1"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>
        
        <Style x:Key="MetricTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFFFFF"/>
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
        
        <Style x:Key="StatusIndicatorStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
        </Style>
        
        <DataTemplate x:Key="AlertItemTemplate">
            <Border Padding="10" Margin="0,0,0,5" 
                    Background="{Binding Severity, Converter={StaticResource SeverityToColorConverter}}"
                    CornerRadius="6">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <Image Grid.Column="0" Source="/Assets/alert-icon.png" 
                           Width="24" Height="24" Margin="0,0,10,0"/>
                    
                    <StackPanel Grid.Column="1">
                        <TextBlock Text="{Binding Title}" 
                                   Foreground="White" 
                                   FontWeight="Bold"
                                   TextWrapping="Wrap"/>
                        <TextBlock Text="{Binding Timestamp, StringFormat='HH:mm:ss'}" 
                                   Foreground="#CCCCCC" 
                                   FontSize="11"/>
                        <TextBlock Text="{Binding Details}" 
                                   Foreground="#EEEEEE" 
                                   FontSize="12"
                                   TextWrapping="Wrap"
                                   Margin="0,5,0,0"/>
                    </StackPanel>
                    
                    <Button Grid.Column="2" 
                            Content="Dismiss" 
                            Style="{StaticResource FlatButtonStyle}"
                            Command="{Binding DataContext.DismissAlertCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                            CommandParameter="{Binding AlertId}"/>
                </Grid>
            </Border>
        </DataTemplate>
    </Window.Resources>
    
    <Grid Background="#1E1E1E">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#007ACC" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Image Source="/Assets/bwp-logo-white.png" Width="32" Height="32" Margin="0,0,15,0"/>
                    <TextBlock Text="BWP ENTERPRISE AGENT" 
                               Foreground="White" 
                               FontSize="20" 
                               FontWeight="Bold"
                               VerticalAlignment="Center"/>
                </StackPanel>
                
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Ellipse Width="10" Height="10" Fill="LimeGreen" Margin="0,0,5,0"/>
                    <TextBlock Text="PROTECTED" 
                               Foreground="White" 
                               FontWeight="Bold"
                               VerticalAlignment="Center"
                               Margin="0,0,20,0"/>
                    
                    <TextBlock Text="{Binding CurrentEndpointId}" 
                               Foreground="#CCCCCC" 
                               VerticalAlignment="Center"
                               Margin="0,0,20,0"/>
                    
                    <TextBlock Text="{Binding Uptime, StringFormat='Uptime: {0:hh\\:mm\\:ss}'}" 
                               Foreground="#CCCCCC" 
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>
            
            <!-- Left Panel - Quick Stats -->
            <StackPanel Grid.Column="0" Margin="0,0,15,0">
                <!-- Risk Score Card -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <TextBlock Text="RISK SCORE" Style="{StaticResource HeaderTextStyle}"/>
                        <lvc:Gauge Grid.Row="1" 
                                  From="0" To="100" 
                                  Value="{Binding RiskScore}"
                                  Uses360Mode="True"
                                  LabelsVisibility="Hidden"
                                  Height="120">
                            <lvc:Gauge.GaugeActiveFill>
                                <LinearGradientBrush>
                                    <GradientStop Offset="0" Color="#4CAF50"/>
                                    <GradientStop Offset="0.5" Color="#FFC107"/>
                                    <GradientStop Offset="1" Color="#F44336"/>
                                </LinearGradientBrush>
                            </lvc:Gauge.GaugeActiveFill>
                        </lvc:Gauge>
                        <TextBlock Text="{Binding RiskScore, StringFormat='{}{0}/100'}" 
                                   HorizontalAlignment="Center"
                                   Style="{StaticResource MetricTextStyle}"/>
                        <TextBlock Text="{Binding RiskLevel}" 
                                   HorizontalAlignment="Center"
                                   Foreground="{Binding RiskLevel, Converter={StaticResource RiskLevelToColorConverter}}"
                                   FontWeight="Bold"/>
                    </StackPanel>
                </Border>
                
                <!-- Protection Status Card -->
                <Border Style="{StaticResource CardStyle}" Margin="0,15,0,0">
                    <StackPanel>
                        <TextBlock Text="PROTECTION STATUS" Style="{StaticResource HeaderTextStyle}"/>
                        
                        <StackPanel Margin="0,10,0,0">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <Ellipse Style="{StaticResource StatusIndicatorStyle}" 
                                         Fill="{Binding ProcessSensorStatus, Converter={StaticResource StatusToColorConverter}}"/>
                                <TextBlock Text="Process Sensor" Foreground="#CCCCCC"/>
                                <TextBlock Text="{Binding ProcessSensorStatus}" 
                                           Foreground="{Binding ProcessSensorStatus, Converter={StaticResource StatusToColorConverter}}"
                                           Margin="5,0,0,0"
                                           FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <Ellipse Style="{StaticResource StatusIndicatorStyle}" 
                                         Fill="{Binding FileSystemSensorStatus, Converter={StaticResource StatusToColorConverter}}"/>
                                <TextBlock Text="File System Sensor" Foreground="#CCCCCC"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <Ellipse Style="{StaticResource StatusIndicatorStyle}" 
                                         Fill="{Binding NetworkSensorStatus, Converter={StaticResource StatusToColorConverter}}"/>
                                <TextBlock Text="Network Sensor" Foreground="#CCCCCC"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <Ellipse Style="{StaticResource StatusIndicatorStyle}" 
                                         Fill="{Binding RegistrySensorStatus, Converter={StaticResource StatusToColorConverter}}"/>
                                <TextBlock Text="Registry Sensor" Foreground="#CCCCCC"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- Quick Actions Card -->
                <Border Style="{StaticResource CardStyle}" Margin="0,15,0,0">
                    <StackPanel>
                        <TextBlock Text="QUICK ACTIONS" Style="{StaticResource HeaderTextStyle}"/>
                        
                        <Button Content="ðŸ”„ Refresh Dashboard" 
                                Style="{StaticResource FlatButtonStyle}"
                                Command="{Binding RefreshDashboardCommand}"
                                Margin="0,5,0,5"/>
                        
                        <Button Content="ðŸ“Š Generate Report" 
                                Style="{StaticResource FlatButtonStyle}"
                                Command="{Binding GenerateReportCommand}"
                                Margin="0,5,0,5"/>
                        
                        <Button Content="âš™ï¸ Agent Settings" 
                                Style="{StaticResource FlatButtonStyle}"
                                Command="{Binding OpenSettingsCommand}"
                                Margin="0,5,0,5"/>
                        
                        <Button Content="ðŸ›¡ï¸ Run Full Scan" 
                                Style="{StaticResource FlatButtonStyle}"
                                Command="{Binding RunFullScanCommand}"
                                Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>
            </StackPanel>
            
            <!-- Center Panel - Charts and Events -->
            <Grid Grid.Column="1" Margin="15,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Real-time Events Chart -->
                <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="REAL-TIME THREAT ACTIVITY" Style="{StaticResource HeaderTextStyle}"/>
                            <TextBlock Text="(Last 60 minutes)" 
                                       Foreground="#888888" 
                                       FontSize="11"
                                       VerticalAlignment="Bottom"
                                       Margin="5,0,0,8"/>
                        </StackPanel>
                        
                        <lvc:CartesianChart Series="{Binding ThreatActivitySeries}" 
                                           Height="200"
                                           Margin="0,10,0,0">
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Title="Time" 
                                          Labels="{Binding TimeLabels}"
                                          LabelFormatter="{Binding TimeFormatter}"/>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis Title="Events" MinValue="0"/>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>
                    </StackPanel>
                </Border>
                
                <!-- Recent Detections -->
                <Border Grid.Row="1" Style="{StaticResource CardStyle}" Margin="0,15,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" 
                                   Text="RECENT DETECTIONS" 
                                   Style="{StaticResource HeaderTextStyle}"/>
                        
                        <DataGrid Grid.Row="1" 
                                  ItemsSource="{Binding RecentDetections}"
                                  AutoGenerateColumns="False"
                                  HeadersVisibility="Column"
                                  BorderThickness="0"
                                  Background="Transparent"
                                  RowBackground="Transparent"
                                  AlternatingRowBackground="#252526"
                                  Margin="0,10,0,0">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Time" 
                                                    Binding="{Binding Timestamp, StringFormat='HH:mm:ss'}"
                                                    Width="80"/>
                                <DataGridTextColumn Header="Threat" 
                                                    Binding="{Binding ThreatName}"
                                                    Width="*"/>
                                <DataGridTextColumn Header="Severity" 
                                                    Binding="{Binding Severity}"
                                                    Width="80">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" 
                                                    Value="{Binding Severity, Converter={StaticResource SeverityToColorConverter}}"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Type" 
                                                    Binding="{Binding DetectionType}"
                                                    Width="120"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>
                
                <!-- System Resources -->
                <Border Grid.Row="2" Style="{StaticResource CardStyle}" Margin="0,15,0,0">
                    <StackPanel>
                        <TextBlock Text="SYSTEM RESOURCES" Style="{StaticResource HeaderTextStyle}"/>
                        
                        <Grid Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- CPU Usage -->
                            <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                <lvc:Gauge Value="{Binding CpuUsage}" 
                                          From="0" To="100"
                                          LabelsVisibility="Hidden"
                                          Height="80"
                                          Width="80"/>
                                <TextBlock Text="CPU" 
                                           HorizontalAlignment="Center"
                                           Foreground="#CCCCCC"
                                           Margin="0,5,0,0"/>
                                <TextBlock Text="{Binding CpuUsage, StringFormat='{}{0}%'}" 
                                           HorizontalAlignment="Center"
                                           Style="{StaticResource MetricTextStyle}"
                                           FontSize="16"/>
                            </StackPanel>
                            
                            <!-- Memory Usage -->
                            <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                <lvc:Gauge Value="{Binding MemoryUsage}" 
                                          From="0" To="100"
                                          LabelsVisibility="Hidden"
                                          Height="80"
                                          Width="80"/>
                                <TextBlock Text="Memory" 
                                           HorizontalAlignment="Center"
                                           Foreground="#CCCCCC"
                                           Margin="0,5,0,0"/>
                                <TextBlock Text="{Binding MemoryUsage, StringFormat='{}{0}%'}" 
                                           HorizontalAlignment="Center"
                                           Style="{StaticResource MetricTextStyle}"
                                           FontSize="16"/>
                            </StackPanel>
                            
                            <!-- Disk Usage -->
                            <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                <lvc:Gauge Value="{Binding DiskUsage}" 
                                          From="0" To="100"
                                          LabelsVisibility="Hidden"
                                          Height="80"
                                          Width="80"/>
                                <TextBlock Text="Disk" 
                                           HorizontalAlignment="Center"
                                           Foreground="#CCCCCC"
                                           Margin="0,5,0,0"/>
                                <TextBlock Text="{Binding DiskUsage, StringFormat='{}{0}%'}" 
                                           HorizontalAlignment="Center"
                                           Style="{StaticResource MetricTextStyle}"
                                           FontSize="16"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>
            
            <!-- Right Panel - Alerts and Notifications -->
            <Grid Grid.Column="2" Margin="15,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Active Alerts -->
                <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="ACTIVE ALERTS" Style="{StaticResource HeaderTextStyle}"/>
                            <Border Background="#F44336" 
                                    CornerRadius="10" 
                                    Padding="5,2" 
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center">
                                <TextBlock Text="{Binding ActiveAlertCount}" 
                                           Foreground="White" 
                                           FontWeight="Bold"
                                           FontSize="11"/>
                            </Border>
                        </StackPanel>
                        
                        <ListView ItemsSource="{Binding ActiveAlerts}" 
                                  ItemTemplate="{StaticResource AlertItemTemplate}"
                                  MaxHeight="300"
                                  Background="Transparent"
                                  BorderThickness="0">
                            <ListView.Template>
                                <ControlTemplate TargetType="ListView">
                                    <ScrollViewer>
                                        <ItemsPresenter/>
                                    </ScrollViewer>
                                </ControlTemplate>
                            </ListView.Template>
                        </ListView>
                        
                        <Button Content="View All Alerts" 
                                Style="{StaticResource FlatButtonStyle}"
                                HorizontalAlignment="Stretch"
                                Margin="0,10,0,0"
                                Command="{Binding ViewAllAlertsCommand}"/>
                    </StackPanel>
                </Border>
                
                <!-- Remediation Actions -->
                <Border Grid.Row="1" Style="{StaticResource CardStyle}" Margin="0,15,0,0">
                    <StackPanel>
                        <TextBlock Text="RECENT REMEDIATIONS" Style="{StaticResource HeaderTextStyle}"/>
                        
                        <DataGrid ItemsSource="{Binding RecentRemediations}"
                                  AutoGenerateColumns="False"
                                  HeadersVisibility="Column"
                                  BorderThickness="0"
                                  Background="Transparent"
                                  RowBackground="Transparent"
                                  AlternatingRowBackground="#252526"
                                  MaxHeight="200"
                                  Margin="0,10,0,0">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Time" 
                                                    Binding="{Binding Timestamp, StringFormat='HH:mm:ss'}"
                                                    Width="80"/>
                                <DataGridTextColumn Header="Action" 
                                                    Binding="{Binding ActionType}"
                                                    Width="120"/>
                                <DataGridTextColumn Header="Target" 
                                                    Binding="{Binding Target}"
                                                    Width="*"/>
                                <DataGridTextColumn Header="Status" 
                                                    Binding="{Binding Status}"
                                                    Width="80">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" 
                                                    Value="{Binding Status, Converter={StaticResource StatusToColorConverter}}"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>
                
                <!-- Telemetry Status -->
                <Border Grid.Row="2" Style="{StaticResource CardStyle}" Margin="0,15,0,0">
                    <StackPanel>
                        <TextBlock Text="TELEMETRY STATUS" Style="{StaticResource HeaderTextStyle}"/>
                        
                        <StackPanel Margin="0,10,0,0">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <Ellipse Width="8" Height="8" Fill="LimeGreen" 
                                         VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Cloud Connection" Foreground="#CCCCCC"/>
                                <TextBlock Text="Connected" 
                                           Foreground="LimeGreen" 
                                           Margin="5,0,0,0"
                                           FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Events in Queue: " Foreground="#888888"/>
                                <TextBlock Text="{Binding EventsInQueue}" 
                                           Foreground="#FFFFFF"
                                           FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Last Sync: " Foreground="#888888"/>
                                <TextBlock Text="{Binding LastSyncTime, StringFormat='HH:mm:ss'}" 
                                           Foreground="#FFFFFF"/>
                            </StackPanel>
                            
                            <Button Content="ðŸ“¤ Force Sync" 
                                    Style="{StaticResource FlatButtonStyle}"
                                    Command="{Binding ForceSyncCommand}"
                                    Margin="0,10,0,0"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
        
        <!-- Footer -->
        <Border Grid.Row="2" Background="#252526" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="BWP Enterprise Agent v" 
                               Foreground="#888888"/>
                    <TextBlock Text="{Binding AgentVersion}" 
                               Foreground="#CCCCCC"
                               FontWeight="Bold"
                               Margin="0,0,20,0"/>
                    
                    <TextBlock Text="Last Update: " 
                               Foreground="#888888"/>
                    <TextBlock Text="{Binding LastUpdateCheck, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" 
                               Foreground="#CCCCCC"
                               Margin="0,0,20,0"/>
                    
                    <TextBlock Text="License: " 
                               Foreground="#888888"/>
                    <TextBlock Text="Enterprise" 
                               Foreground="#4CAF50"
                               FontWeight="Bold"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="ðŸ†˜ Help" 
                            Style="{StaticResource FlatButtonStyle}"
                            Margin="0,0,10,0"/>
                    <Button Content="â¹ï¸ Minimize to Tray" 
                            Style="{StaticResource FlatButtonStyle}"
                            Command="{Binding MinimizeToTrayCommand}"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>